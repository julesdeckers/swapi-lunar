import Head from 'next/head'
import Link from 'next/link';
import styled from 'styled-components';
import { useEffect, useState } from 'react';

import useFetch from '@lib/hooks/useFetch';
import useStored from '@lib/hooks/useStored';
import useCharacterFetch from '@lib/hooks/useCharacterFetch';
import { useCharacterStore } from '@lib/stores/StarWarsStore';
import { API_URL, URLS } from '@utils/API_URL';

import CharacterCard from '@components/general/CharacterCard';


const MainView = styled.div`
grid-area: main;
text-align: left;
margin-top: 10rem;
padding: 1rem;
display: grid;
grid-template-columns: 1fr 1fr 1fr 1fr;
gap: 1rem;
grid-auto-rows: 30rem;
overflow: scroll;
height: auto;
`;

export default function Home() {
  const [url, _] = useState(`${API_URL}/people`);
  const { data, isLoading } = useFetch(url);
  const { fulldata, isFullLoading } = useCharacterFetch(URLS);
  const [characters, setCharacters] = useState(null);
  const stored = useStored();
  useEffect(() => {
    console.log(stored);
    if (!isLoading && data) setCharacters(data.results);
    if (!isFullLoading && fulldata) setCharacters(fulldata);
  }, [data, fulldata]);
  if (stored) return (
    <>
      <Head>
        <title>Swapi | LunarDev</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <MainView>
        {stored &&
          stored.map((char, index) => { return (<CharacterCard data={char} key={index} />) })
        }
      </MainView>
    </>
  )
  return (
    <>
      <Head>
        <title>Swapi | LunarDev</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {isLoading
        ? <MainView><p>Laden...</p></MainView>
        : <MainView>
          {characters &&
            characters.map((char, index) => { return (<CharacterCard data={char} key={index} />) })
          }
        </MainView>
      }
    </>
  )
}